/* ðŸŽµ CINEMATIC AMBIENT BACKGROUND MUSIC */

let audioContext;
let masterGain;
let oscillators = [];

function startCinematicMusic(){
  audioContext = new (window.AudioContext || window.webkitAudioContext)();

  masterGain = audioContext.createGain();
  masterGain.gain.value = 0; // start silent
  masterGain.connect(audioContext.destination);

  // Deep ambient base layer
  createLayer(110, "sine");   // deep warm tone
  createLayer(220, "triangle"); // magical mid layer
  createLayer(440, "sine");   // soft high shimmer

  fadeIn();
}

function createLayer(frequency, type){
  let osc = audioContext.createOscillator();
  let gain = audioContext.createGain();

  osc.type = type;
  osc.frequency.value = frequency;

  gain.gain.value = 0.03; // very soft individual layers

  osc.connect(gain);
  gain.connect(masterGain);

  osc.start();

  oscillators.push(osc);
}

function fadeIn(){
  let volume = 0;
  let fade = setInterval(function(){
    if(volume < 0.15){
      volume += 0.005;
      masterGain.gain.value = volume;
    } else {
      clearInterval(fade);
    }
  }, 200);
}

/* Sparkles */
for(let i=0;i<120;i++){
  let star=document.createElement("div");
  star.className="sparkle";
  star.style.left=Math.random()*100+"vw";
  star.style.animationDuration=(Math.random()*6+4)+"s";
  document.body.appendChild(star);
}

function goPassword(){
  document.getElementById("intro").classList.add("hidden");
  document.getElementById("password").classList.remove("hidden");
}

function unlock(){
  let pass=document.getElementById("passInput").value.trim().toLowerCase();

  if(pass==="gryffindor"){

    startCinematicMusic(); // ðŸŽµ Starts smooth ambient music

    document.getElementById("password").classList.add("hidden");
    document.getElementById("lionScreen").classList.remove("hidden");

    setTimeout(showLetter,2500);

  }else{
    alert("Even SRK would remember the password.");
  }
}

function showLetter(){
  document.getElementById("lionScreen").classList.add("hidden");
  document.getElementById("letterScreen").classList.remove("hidden");
  typeWriter();
}

/* Typewriter */
let text="Dear Mr. Sasta SRK (aka Dhadpadyaa),\n\nThe Ministry confirms that today marks the birthday of a Gryffindor who may fall often â€” but always rises dramatically.\n\nYou may gossip.\nYou may pretend to be SRK.\nYou may possess legendary molu-golu enchanted skin.\n\nBut today, the wizarding world celebrates YOU.";

let i=0;

function typeWriter(){
  if(i<text.length){
    document.getElementById("typewriter").innerHTML+=text.charAt(i);
    i++;
    setTimeout(typeWriter,30);
  }
}

function celebrate(){
  for(let i=0;i<30;i++){
    let fw=document.createElement("div");
    fw.className="firework";
    fw.style.left=Math.random()*100+"vw";
    fw.style.top=Math.random()*100+"vh";
    document.body.appendChild(fw);
  }
}
